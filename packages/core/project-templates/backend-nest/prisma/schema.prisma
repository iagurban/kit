datasource db {
  url      = env("DATABASE_URL")
  provider = "postgresql"
}

generator oldClient {
  provider      = "prisma-client-js"
  output        = "../src/generated/old-client"
  engineType    = "binary"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

generator client {
  provider      = "prisma-client"
  output        = "../src/generated/db-client"
  engineType    = "binary"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

generator json {
  provider = "yarn prisma-json-types-generator"
}

generator nestgraphql {
  provider = "prisma-nestjs-graphql"
  output   = "../src/generated/nestgraphql"

  prismaClientImport = "../../db-client"
  purgeOutput        = true
}

// generator nestjsDto {
//   provider = "prisma-generator-nestjs-dto"
//   output   = "../src/generated/nestjs-dto"
//
//   outputToNestJsResourceStructure = "true" // writes dtos and entities to subfolders aligned with NestJS CRUD generator (false)
//   exportRelationModifierClasses   = "true" // Should extra classes generated for relationship field operations on DTOs be exported? (true)
//   reExport                        = "false" // Should an index.ts be created for every folder? (false)
//   createDtoPrefix                 = "Create" // phrase to prefix every CreateDTO class with (Create)
//   updateDtoPrefix                 = "Update" // phrase to prefix every UpdateDTO class with (Update)
//   dtoSuffix                       = "Dto" // phrase to suffix every CreateDTO and UpdateDTO class with (Dto)
//   entityPrefix                    = "" // phrase to prefix every Entity class with (<empty>)
//   entitySuffix                    = "" // phrase to suffix every Entity class with (<empty>)
//   fileNamingStyle                 = "camel" // how to name generated files. Valid choices are "camel", "pascal", "kebab" and "snake". (camel)
// }

// generator erd {
//   provider = "prisma-erd-generator"
//
//   output   = "../prisma/ERD.svg" // svg (default: ./prisma/ERD.svg), png, pdf, md
//   // theme    = "forest" // default, forest, dark, neutral
//   mmdcPath = "./CI"
//
//   // tableOnly = true
//   // ignoreEnums = true
//   includeRelationFromFields = true
//   // disableEmoji = true
//   // puppeteerConfig = "../puppeteerConfig.json"
// }

// generator prismaClassGenerator {
//   provider = "prisma-class-generator"
//
//   output = "../src/generated/classes"
//
//   dryRun                   = false
//   // useSwagger = false
//   // makeIndexFile = false
//   // separateRelationFields = true
//   clientImportPath         = "../db-client"
//   useNonNullableAssertions = false
//   preserveDefaultNullable  = true
// }

// generator joi {
//   provider = "prisma-joi-generator"
//   output   = "../src/generated/joi"
// }

generator zod {
  provider = "prisma-zod-generator"
  output   = "../src/generated/zod"

  isGenerateSelect  = true
  isGenerateInclude = true
}

generator typescriptInterfaces {
  provider = "prisma-generator-typescript-interfaces"

  output      = "../src/generated/interfaces.ts"
  modelType   = "type"
  enumType    = "enum"
  decimalType = "number"
  // optionalNullables = true
  // prettier    = true
}

// generator crudGrahql {
//   provider = "nestjs-prisma-graphql-crud-gen"
//   output   = "../generated/crud"
// }

model User {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt DateTime @default(now())

  email String @unique
  name  String @unique

  passwordHash String @map("externalId")

  refreshTokens RefreshToken[]
}

model RefreshToken {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  expiresAt DateTime

  hash String
}
