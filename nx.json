{
  "defaultProject": "gateway",
  "targetDefaults": {
    "build": {
      "cache": true,
      "outputs": [
        "{options.outputPath}"
      ],
      "dependsOn": [
        "^build"
      ]
    },
    "serve": {
      "cache": false
    },
    "test": {
      "cache": true
    },
    "lint": {
      "cache": true
    },
    "@nx/js:tsc": {
      "cache": true,
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "default",
        "^default"
      ]
    },
    "@nx/jest:jest": {
      "cache": true,
      "inputs": [
        "default",
        "^default",
        "{workspaceRoot}/jest.preset.js"
      ],
      "options": {
        "passWithNoTests": true
      },
      "configurations": {
        "ci": {
          "ci": true,
          "codeCoverage": true
        }
      }
    },
    "build-and-watch-backend": {
      "executor": "@poslah/nx-poslah:nodemon",
      "options": {
        "watch": [
          "./{projectRoot}/src",
          "./libs/util/src",
          "./libs/kit/src",
          "./libs/database/src"
        ],
        "ext": "ts,json,proto,{addExt}",
        "addExt": "",
        "exec": "nx build {projectName}",
        "cwd": "{workspaceRoot}"
      }
    },

    "run-and-watch-backend": {
      "executor": "@poslah/nx-poslah:nodemon",
      "options": {
        "watch": ["./dist"],
        "exec": "yarn node ./dist/{projectRoot}/{executablePath}",
        "cwd": "{workspaceRoot}/{projectRoot}",
        "executablePath": "src/main.js"
      }
    },

    "build-service-ts": {
      "executor": "@poslah/nx-poslah:run",
      "outputs": ["{workspaceRoot}/dist/{projectRoot}"],
      "options": {
        "commands": [
          "yarn tsc -p {projectRoot}/tsconfig.build.json",
          "yarn tsc-alias -p {projectRoot}/tsconfig.build.json"
        ],
        "cwd": "{workspaceRoot}"
      },
      "dependsOn": []
    },

    "copy-assets": {
      "executor": "@poslah/nx-poslah:run",
      "outputs": ["{workspaceRoot}/dist/{projectRoot}"],
      "options": {
        "commands": [
          "yarn ts-node 'libs/kit/src/bin/copy.ts' -i '{apps,libs}/**/*.{proto,json,lua}' -x '**/node_modules/**' -x '**/dist/**' -v '{projectRoot}/dist'"
        ],
        "stopOnFail": true,
        "cwd": "{workspaceRoot}"
      }
    },

    "kill-nx-daemon": {
      "executor": "@poslah/nx-poslah:run",
      "options": {
        "commands": ["ps aux | grep 'nx/src' | grep -v grep | awk '{print $2}' | xargs kill"]
      }
    },

    "serve-backend": {
      "executor": "@poslah/nx-poslah:concurrently",
      "options": {
        "processes": [
          {
            "name": "build",
            "color": "cyan",
            "command": "yarn nx build-and-watch-backend {projectName}"
          },
          {
            "name": "run",
            "color": "yellow",
            "command": "yarn nx run-and-watch-backend {projectName}"
          }
        ],
        "cwd": "{workspaceRoot}"
      },
      "dependsOn": ["kill-nx-daemon"]
    },

    "generate-proto-code": {
      "executor": "@poslah/nx-poslah:run",
      "options": {
        "commands": [
          "mkdir -p ./src/generated.grpc",
          "$(yarn bin grpc_tools_node_protoc) --plugin=$(yarn bin protoc-gen-ts_proto) --ts_proto_opt=nestJs=true,forceLong=long --ts_proto_out=./src/generated.grpc ./src/grpc/{protoFileName}.proto"
        ],
        "cwd": "{workspaceRoot}/{projectRoot}"
      }
    }
  },
  "plugins": [
    {
      "plugin": "@nx/webpack/plugin",
      "options": {
        "buildTargetName": "build",
        "serveTargetName": "serve",
        "previewTargetName": "preview"
      }
    },
    {
      "plugin": "@nx/eslint/plugin",
      "options": {
        "targetName": "lint"
      }
    }
  ]
}
